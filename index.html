<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte GPS Statique</title>
    <style>
        #map { width: 600px; height: 400px; display: block; margin: auto; }
        #weather-panel {
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
    </style>
</head>
<body>
    <img id="map" src="" alt="Carte satellite statique">
    <div id="weather-panel">Chargement météo...</div>
    
    <script>
        function getQueryParams() {
            var params = new URLSearchParams(window.location.search);
            return {
                LatOri: params.get("LatOri"),
                LonOri: params.get("LonOri"),
                LatZero: params.get("LatZero"),
                LonZero: params.get("LonZero"),
                LatMaxAngle: params.get("LatMaxAngle"),
                LonMaxAngle: params.get("LonMaxAngle"),
                LatPiv: params.get("LatPiv"),
                LonPiv: params.get("LonPiv"),
                PivCirc: params.get("PivCirc")
            };
        }
        
        var coords = getQueryParams();
        
        // Génération de la carte satellite statique avec lignes entre les points
        var mapUrl = "https://static-maps.yandex.ru/1.x/?l=sat&size=600,400"
            + "&pt=" + coords.LonOri + "," + coords.LatOri + ",pm2rdm~"
            + coords.LonZero + "," + coords.LatZero + ",pm2blm~"
            + coords.LonMaxAngle + "," + coords.LatMaxAngle + ",pm2grm~"
            + coords.LonPiv + "," + coords.LatPiv + ",pm2org"
            + "&pl=c:ff0000,w:4," + coords.LonOri + "," + coords.LatOri + "," + coords.LonZero + "," + coords.LatZero // Ligne rouge
            + "&pl=c:0000ff,w:4," + coords.LonOri + "," + coords.LatOri + "," + coords.LonMaxAngle + "," + coords.LatMaxAngle // Ligne bleue
            + "&pl=c:00ff00,w:4," + coords.LonOri + "," + coords.LatOri + "," + coords.LonPiv + "," + coords.LatPiv; // Ligne verte
        
        document.getElementById("map").src = mapUrl;
        
        // Récupération des infos météo via XMLHTTPRequest pour compatibilité avec Weintek
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "https://wttr.in/?format=%t\n%h\n%P\n%D\n%T", true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var data = xhr.responseText.split("\n");
                document.getElementById("weather-panel").innerHTML =
                    "<strong>Météo :</strong><br>" +
                    "<strong>Température :</strong> " + data[0] + "<br>" +
                    "<strong>Hygrométrie :</strong> " + data[1] + "<br>" +
                    "<strong>Risque de pluie :</strong> " + data[2] + "<br>" +
                    "<strong>Date :</strong> " + data[3] + "<br>" +
                    "<strong>Heure :</strong> " + data[4];
            }
        };
        xhr.send();
    </script>
</body>
</html>
