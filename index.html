<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secteur Circulaire</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map {
            height: 100vh;
        }

        .sector {
            fill: rgba(0, 0, 255, 0.5);
            stroke: blue;
            stroke-width: 2;
        }

        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>

<body>
    <div id="info"></div>
    <div id="map"></div>

    <script>
        // Fonction pour obtenir les paramètres de l'URL  
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(window.location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Récupérer les paramètres de l'URL  
        const LatOri = parseFloat(getUrlParameter('LatOri'));   // Point d'origine (sommet)
        const LonOri = parseFloat(getUrlParameter('LonOri'));    // Point d'origine (sommet)
        const LatZero = parseFloat(getUrlParameter('LatZero'));   // Point Zéro (un côté)
        const LonZero = parseFloat(getUrlParameter('LonZero'));    // Point Zéro (un côté)
        const LatDt = parseFloat(getUrlParameter('LatDt'));     // Troisième Point (l'autre côté)
        const LonDt = parseFloat(getUrlParameter('LonDt'));      // Troisième Point (l'autre côté)
        const movement = getUrlParameter('movement');  // Angle du pivot  
        const pivotState = getUrlParameter('pivotState'); // État du pivot

        const map = L.map('map').setView([LatOri, LonOri], 15);

        // Couche de la carte satellite  
        L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Afficher les informations sur le panneau 
        const infoPanel = document.getElementById('info');
        infoPanel.innerHTML = `
            <strong>Informations du Secteur :</strong><br>
            Point d'Origine : (${LatOri.toFixed(6)}, ${LonOri.toFixed(6)})<br>
            Point Zéro : (${LatZero.toFixed(6)}, ${LonZero.toFixed(6)})<br>
            Troisième Point : (${LatDt.toFixed(6)}, ${LonDt.toFixed(6)})<br>
            Angle du Pivot : ${movement}<br>
            État du Pivot : ${pivotState}
        `;

        // Fonction pour dessiner le secteur circulaire  
        function drawSector() {
            const points = [
                [LatOri, LonOri], // Point d'origine (sommet)
                [LatZero, LonZero], // Point Zéro (un côté)
                [LatDt, LonDt] // Troisième point (l'autre côté)
            ];

            // Tracer l'arc de cercle uniquement entre le Point Zéro et le Troisième Point  
            const arcPoints = [];
            const numPoints = 100; // Nombre de points pour l'arc  
            const radius = 0.001;  // Rayon pour l'arc  
            const angleStart = Math.atan2(LatZero - LatOri, LonZero - LonOri);
            const angleEnd = Math.atan2(LatDt - LatOri, LonDt - LonOri);
            const angleDiff = angleEnd - angleStart;

            for (let i = 0; i <= numPoints; i++) {
                const t = i / numPoints;
                const angle = angleStart + angleDiff * t;
                arcPoints.push([
                    LatOri + radius * Math.sin(angle),
                    LonOri + radius * Math.cos(angle)
                ]);
            }

            // Ajouter les points de l'arc entre le point Zéro et le point Troisième  
            points.splice(1, 0, ...arcPoints); // Insérer l'arc entre le point d'origine et les deux autres points

            // Créer le secteur circulaire  
            L.polygon(points, { className: 'sector' }).addTo(map);
        }

        drawSector(); // Appeler la fonction pour dessiner le secteur  
    </script>
</body>

</html>
